# Shiva_DM

/*******************************************************************
* Client:  Roche                                                          
* Product: Drug A                                                  
* Project:  Multi center, double blinded                                                   
* Program: Ali.SAS  
*
* Program Type: Listing
*
* Purpose: To produc
* Usage Notes: 
*
* SASÂ® Version: 9.2 [TS2M0]
* Operating System: Windows 2003 R2 Standard Edition.                   
*
* Author: Ali
* Date Created: 2022-10-08
*******************************************************************/				

/*Import raw datasets*/

libname raw 'D:\SAS\SAS SHIVA\STD ROSHE\RAW DATASETS';

options nofmterr;
data DM (RENAME=(AGE_=AGE SEX_=SEX));
set raw.dm;
STUDYID='043-18101';
DOMAIN='DM';
USUBJID=STRIP(STUDYID||'-'||SUBNUM);
SUBJID=SCAN(SUBNUM,2,'-');
SITEID=STRIP(SITENUM);
IF AGE ^= '.' THEN AGEU='YEARS';
BRTHDTC=PUT(YOB, BEST.);
AGE_=AGE;
SEX_=SEX;
ETHINIC=ETHNIC_DEC;
KEEP STUDYID DOMAIN USUBJID SITEID BRTHDTC AGE AGEU SEX ETHINIC;
RUN;


/*DERIVING RFSTDTC RFXSTDTC*/
DATA DM1;
SET RAW.EX;
USUBJID=STRIP('043-18101'||'-'||SUBNUM);
IF VISNAME='Cycle 1 - Day 1 (1st infusion)';
RFSTDTC=PUT(EXSTDAT,IS8601DA.)||'T'|| PUT(EXSTTIM, TOD5.);
RFXSTDTC=PUT(EXSTDAT,IS8601DA.)||'T'|| PUT(EXSTTIM, TOD5.);
KEEP RFSTDTC RFXSTDTC USUBJID EXLEVEL;
RUN;

/*DERIVING RFENDTC RFXENDTC RFPENDTC*/
DATA DM2;
SET RAW.DS_EOT;
USUBJID=STRIP('043-18101'||'-'||SUBNUM);
RFENDTCN_=PUT(DSDAT, IS8601DA.);
RFXENDTCO_=PUT(DSCDAT,IS8601DA.);
RFPENDTC_=PUT(DSTRTDAT, IS8601DA.);
KEEP USUBJID RFENDTC_ RFXENDTC_ RFPENDTC_;
RUN;

DATA DM2_1;
SET DM2 (WHERE=(DATE ^= '.') RENAME=(RFENDTCN_=DATE))
DM2 (WHERE=(DATE ^= '.') RENAME=(RFXENDTCO_=DATE));
BY USUBJID DATE;
IF LAST.USUBJID;
RFENDTC=DATE;
RFXENDTC=DATE;
KEEP USUBJID RFENDTC RFXENDTC ;
RUN;

/*DERIVING RFPENDTC*/
DATA DM2_2;
SET RAW.EOS;
USUBJID=STRIP('043-18101'||'-'||SUBNUM);
RFPENDTC=PUT(DSDAT, IS8601DA.);
KEEP USUBJID RFPENDTC;
RUN;

/*DERIVING RFICDTC*/
DATA DM3;
SET RAW.DS_IC;
USUBJID=STRIP('043-18101'||'-'||SUBNUM);
IF PAGENAME='Informed Consent' THEN RFICDTC=PUT(RFICDAT, IS8601DA.);
KEEP USUBJID RFICDTC;
RUN;

/*RACE VARIABLE*/
DATA DM4;
SET DM;
USUBJID=STRIP('043-18101'||'-'||SUBNUM);
IF WHITE='X' THEN RACE='WHITE';
IF BLACK='X' THEN RACE='BLACK OR AFRICAN AMERICAN';
IF NATIVE='X' THEN RACE='AMERICAN INDIAN OR ALASKA NATIVE';
IF ASIAN='X' THEN RACE='ASIAN';
IF PACIFIC='X' THEN RACE='NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER';
IF OTHER='X' THEN RACE='OTHER';
IF RACEUNK='X' THEN RACE='UNKNOWN';
KEEP USUBJID RACE;
RUN;

/*DERIVING DTHDTC DTHFL*/
DATA DM5;
SET RAW.DTH;
USUBJID=STRIP('043-18101'||'-'||SUBNUM);
DTHDTC=PUT(DTHDAT, IS8601DA.);
DTHFL='Y';
KEEP USUBJID DTHDTC DTHFL;
RUN;

%MACRO SORT (DSAT,VAR);
PROC SORT DATA=&DSAT;
BY &VAR;
RUN;
%MEND;

%SORT(DM,USUBJID);
%SORT(DM1, USUBJID);
%SORT(DM2_1, USUBJID);
%SORT(DM2_2, USUBJID);
%SORT(DM3, USUBJID);
%SORT(DM4, USUBJID);
%SORT(DM5, USUBJID);

/*MERGE DATASETS*/
DATA DM_FINAL;
MERGE DM (IN=A) DM1 DM2_1 DM2_2 
DM3 (WHERE=(RFICDTC^=' '))
DM4 DM5;
BY USUBJID;
IF A;
RUN;

/*DERIVE ARMCD ARM ACTARMCD ACTARM COUNTRY*/
DATA DM_FINAL1;
SET DM_FINAL;
